
steps:
  - id: check npm version   
    name: node:22-alpine
    entrypoint: npm
    args: ["--version"]

  - id: check files
    name: ubuntu
    entrypoint: bash
    args:
      - '-c' 
      - |  
        pwd
        ls -l   

  - id: install js packages
    name: node:22-alpine
    entrypoint: npm
    args: ["install"]

  - id: build js
    name: node:22-alpine
    entrypoint: npm
    args: ["run", "build"]

  - id: build docker imageq
    name: gcr.io/cloud-builders/docker
    args: ['build','-t','europe-west2-docker.pkg.dev/$PROJECT_ID/my-docker-repo/${_APP_NAME}', '.']                                              

  - id: push docker image to GAR
    name: gcr.io/cloud-builders/docker
    args: [ 'push', 'europe-west2-docker.pkg.dev/$PROJECT_ID/my-docker-repo/${_APP_NAME}' ]









logsBucket: gs://jason-hsbc_cloudbuild/logs/
options: # https://cloud.google.com/cloud-build/docs/build-config#options
  logging: GCS_ONLY # or CLOUD_LOGGING_ONLY https://cloud.google.com/cloud-build/docs/build-config#logging

substitutions:
  _DOCKER_REPO_NAME: my-docker-repo
  _APP_NAME: myui
  _GAR_BASE: europe-west2-docker.pkg.dev
  _PORT: "8082"
  _VM_HOST: "tf-vpc0-subnet0-vm0"